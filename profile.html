<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Document</title>
     <link rel="stylesheet" href="css/style.css">
     <link rel="stylesheet" type="text/css" href="css/forms.auth.css"/>
</head>
<style>

  #bookings-table{
    font-family: Arial, Helvetica, sans-serif;
    border-collapse: collapse;
    width: 100%;
  }

  #bookings-table td, #bookings-table th {
    border: 1px solid #ddd;
    padding: 8px;
  }

  #bookings-table tr:nth-child(even){background-color: #f2f2f2;}

  #bookings-table tr:hover {background-color: #ddd;}

  #bookings-table th {
    padding-top: 12px;
    padding-bottom: 12px;
    text-align: left;
    background-color: var(--primary-light);
    color: white;
  }
  table a{
    color: var(--primary-light)
  }
  .status-approved{
    font-size: 12px;
    background-color: green;
    border-radius: 8px;
    padding: 8px 20px;
    color: #fff;
  }
  .status-declined{
    font-size: 12px;
    background-color: red;
    border-radius: 8px;
    padding: 8px 20px;
    color: #fff;
  }
  .status-pending{
    font-size: 12px;
    background-color: yellow;
    border-radius: 8px;
    padding: 8px 20px;
    color: #222;
  }
</style>
</style>
<body>
	<header >
          <div class="brand flex justify-space-between align-center">
               <div class="flex align-center">
                    <div class="logo"><a href="index.html"><img src="./images/logo.png" alt=""></a></div>
                    <div class="typo">GOKYO PEAKS Travels & Tours</div>
               </div>
               <div class="hide-lg hamburger"><i class="fas fa-bars"></i></div>
          </div>
          <nav class="flex hide">
              <ul class="menu">
                    <li><a class="active" href="index.html">Home</a></li>
                    <li><a href="index.html">Flights</a></li>
                    <li><a href="index.html">Vehicles</a></li>
                    <li><a href="index.html">Rooms</a></li>
                    <li><a href="about.html">About Us</a></li>
                    <li><a href="#" class="btn" onclick="showPopUp('signin')">Signin</a></li>
                    <li><a href="#" class="btn" onclick="showPopUp('signup')" style="background: var(--primary-light); color: #fff">Signup</a></li>
              </ul>
              <div class="action">
                    <a href="#" class="btn">Hello, User</a><span class="icon">G</span>
                    <ul>
                         <li><a href="profile.html">View Profile</a></li>
                         <li><a href="#" onclick="logout()">Logout</a></li>
                    </ul>
              </div>
          </nav>
     </header>

     <section class="profile-content">
        <div class="tabs">
             <div class="tab active" onclick="showTab(event, 'detail')">Personal Details</div>
             <div class="tab" onclick="showTab(event, 'package-orders')">Package Orders</div>
             <div class="tab" onclick="showTab(event, 'flight-orders')">Flight Orders</div>
             <div class="tab" onclick="showTab(event, 'room-orders')">Room Orders</div>
             <div class="tab" onclick="showTab(event, 'vehicle-orders')">Vehicle Orders</div>
        </div>	
        <div class="tabContent">
	         <div class="detail show">
	         	<form id="detailForm">
	         		<div class="input">
	         			<label for="f_name">First Name</label>
	         			<input id="f_name" type="text" value="Gokyo User">
	         		</div>
              <div class="input">
                <label for="m_name">Middle Name</label>
                <input id="m_name" type="text" value="Gokyo User">
              </div> 
	         		<div class="input">
	         			<label for="l_name">Last Name</label>
	         			<input id="l_name" type="text" value="Gokyo User">
	         		</div>
                   <div class="input">
                        <label for="gender">Gender</label>
                        <select name="gender" id="gender">
                          <option value="">Select Gender</option>
                          <option value="Male">Male</option>
                          <option value="Female">Female</option>
                          <option value="Others">Others</option>
                        </select>
                   </div>
                   <div class="input">
                        <label for="dob">DOB:</label>
                        <input type="date" id="dob" name="dob" value="2021-09-01"> 
                   </div>
                   <div class="input">
                         <label for="email">Email</label>
                        <input type="text" id="email" name="email" placeholder="eg: johndoe@gmail.com"> 
                   </div>
                   <div class="input">
                        <label for="phone">Phone</label>
                        <input type="text" id="phone" name="phone" placeholder="eg: 9876543210">
                   </div>
                   <div class="input">
                        <label for="street">Street</label>
                        <input type="text" id="street" name="street" placeholder="eg: 123 Main Street">
                   </div>
                   <div class="input">
                        <label for="city">City</label>
                        <input type="text" id="city" name="city" placeholder="eg: New York City">
                   </div>
                   <div class="input">
                        <label for="state_region">State/Region</label>
                        <input type="text" id="state_region" placeholder="eg: New York">
                   </div>
                   <div class="input">
                        <label for="postal_code">Postal Code</label>
                        <input type="text" id="postal_code" placeholder="eg: 10030 ">
                   </div>
                   <div class="input" >
                        <label for="country">Country</label>
                        <select id="country" name="country" class="form-control">
                         <option value="">Select Country</option>
                         <option value="Nepal">Nepal</option>
                         <option value="Other">Other</option>
                     </select>
                   </div>
                  <div class="input" style="display:none">
                      <label for="first-name">Citizenship/Passport</label>
                      <select name="document" id="reference_doc_type" onchange="uploadDocument()">
                        <option value="none">Select Document</option>
                        <option value="citizenship">Citizenship</option>
                        <option value="passport">Passport</option>
                      </select>
                 </div>
                 <div class="upload-document citizenship-details wrapper">
                      <div class="input">
                           <label for="citizenship-media-front">Citizenship ID Front</label>
                           <input type="file" id="citizenship-media-front" name="citizenship-media-front">
                      </div>
                      <div class="input">
                           <label for="citizenship-media-front">Citizenship ID Back</label>
                           <input type="file" id="citizenship-media-back" name="citizenship-media-back">
                      </div>         
                      <div class="input">
                           <label for="citizenship-number">Citizenship Number</label>
                           <input type="text" name="citizenship-number" id="citizenship-number" placeholder="eg: 58-76-04-8474">
                      </div>
                      <div class="input">
                           <label for="citizenship-issue-date">Issue Date</label>
                           <input type="date" name="citizenship-issue-date" id="citizenship-issue-date">                                 
                      </div>
                 </div>
                 <div class="upload-document passport-details wrapper">
                      <div class="input">
                           <label for="passport-media">Passport</label>
                           <input type="file" id="passport-media" name="passport-media">
                      </div>         
                      <div class="input">
                           <label for="passport-number">Passport Number</label>
                           <input type="text" name="passport-number" id="passport-number" placeholder="eg: 58-76-04-8474">
                      </div>
                      <div class="input">
                           <label for="passport-expiry-date">Expiry Date</label>
                           <input type="date" name="passport-expiry-date" id="passport-issue-date">
                      </div>
                 </div>
                 <div style="width: 100%; text-align: center">
                    <input type="Submit" value="Submit">
                 </div> 
	         	</form>
          	</div>
	         <div class="package-orders">
	         	<table id="bookings-table">
                <tr>
                  <th>Package</th>
                  <th>Booked Date</th>
                  <th>Number of persons</th>
                  <th>Status</th>
                </tr>
            </table>
	         </div>	
	         <div class="flight-orders">
	         	Flight Orders
	         </div>	
	         <div class="room-orders">
	         	Room Orders
	         </div>
	         <div class="vehicle-orders">
	         	Vehicle Orders
	         </div>		
	     </div>
     	
     </section>

     <div class="booking-fixed-icons">
          <div class="parent">
               <div class="children">
                    <a href="book.html" class="book-item"><i class="fa fa-plane"></i><span>Flights</span></a>
                    <a href="book.html" class="book-item"><i class="fa fa-taxi"></i><span>Vehicles</span></a>
                    <a href="book.html" class="book-item"><i class="fa fa-hotel"></i><span>Hotels</span></a>
                    <a href="book.html" class="book-item"><i class="fa fa-hiking"></i><span>Holidays</span></a>
               </div>
               <div class="head">Book<br>Now</div>
          </div>
     </div>

<footer>
     <div class="top">
          <div class="menu-links links">
               <h3>Important Links</h3>
               <ul>
                    <li><a href="#">Home</li>
                    <li><a href="#">Book FLights</a></li>
                    <li><a href="#">Book Vehicles</a></li>
                    <li><a href="#">Book Rooms</a></li>
                    <li><a href="#">See Packages</a></li>
               </ul>
          </div>
          <div class="packages-links links">
               <h3>Trending Packages</h3>
               <ul>
                    <li><a href="#">Bunjee Jump</li>
                    <li><a href="#">Annapurna Trekking</a></li>
                    <li><a href="#">Jungle Safari</a></li>
                    <li><a href="#">Paragliding</a></li>
                    <li><a href="#">Lake Rara</a></li>
               </ul>
          </div>
          <div class="about-us">
               <h3>About Us</h3>
               <p>
               </p>
          </div>
          <div class="contact">
               <div class="details">
                    <h3>Contact Details</h3>
                    <p>
                         <div><i class="fa fa-map-marker"></i><span>Address: Baneshwor, Kathmandu</span></div>
                         <div><i class="fa fa-phone"></i><span>Phone: 01-9876548, 01-947464</span></div>
                         <div><i class="fa fa-envelope"></i><span>Email: gokyo@gmail.com</span></div>
                    </p>
               </div>
               <div class="social">
                    <h3>Get Connected On</h3>
                    <p>
                         <a href=""><img src="./images/social-icons/facebook.png"></a>
                         <a href=""><img src="./images/social-icons/instagram.png"></a>
                         <a href=""><img src="./images/social-icons/youtube.png"></a>
                    </p>
               </div>
          </div>
          <img src="images/footer/footer-image.png" alt="">
     </div>
     <div class="bottom flex align-center justify-center"><span>Â© 2021, GOKYO PEAK TRAVELS & TOURS</span>  |  <span>ALL RIGHTS RESERVED</span>  |  <span>Design & Developed By: Lightweb Group</span></div>
</footer>
</body>
<script src="js/jquery.min.js"></script>
<script src="./js/main.js"></script>
<script>

const setUserDetails = function (user){
  $('#detailForm #f_name')[0].value = user.first_name
  $('#detailForm #m_name')[0].value = user.middle_name
  $('#detailForm #l_name')[0].value = user.last_name
  $('#detailForm #dob')[0].value = user.dob
  $('#detailForm #email')[0].value = user.email
  $('#detailForm #phone')[0].value = user.contact
  $('#detailForm #street')[0].value = user.street
  $('#detailForm #city')[0].value = user.city
  $('#detailForm #state_region')[0].value = user.state_region
  $('#detailForm #postal_code')[0].value = user.postal_code

  if(user.gender == null)
    $('#detailForm #gender option')[0].setAttribute('selected', "true")

  if(user.gender == "M")
    $('#detailForm #gender option')[1].setAttribute('selected', "true")

  if(user.gender == "F")
    $('#detailForm #gender option')[2].setAttribute('selected', "true")

  if(user.country == "Nepal")
    $('#detailForm #country option')[1].setAttribute('selected', "true")
  else
    $('#detailForm #country option')[2].setAttribute('selected', "true")


  if(user.reference_doc_type != "citizenship")
    $('#detailForm #reference_doc_type').val('passport').trigger('change');
  else
    $('#detailForm #reference_doc_type').val('citizenship').trigger('change');

}

  $(document).ready(function (){
  	const queryString = window.location.search;
  	const urlParams = new URLSearchParams(queryString);
  	const id = localStorage.getItem('gokyo_user_id')
  	const url = `http://18.206.147.162/api/v1/users/${id}/`

    if(id && localStorage.getItem('gokyo_key')){
        fetch(url).then(response=>{
               if(response.status == 200){
                    response.json().then(user=>{
                      setUserDetails(user)
                    })  
               } else{
                    response.json().then(err=>{
                         console.log(err)
                         window.location.href = `./index.html`    
                    })
               }
        })
    } else {
        window.location.href = `./index.html`
    }
  })
  uploadDocument()

  fetchData(`http://18.206.147.162/api/v1/booking/search/?id=${localStorage.getItem('gokyo_user_id')}`).then(bookings=>{
       let table = $('#bookings-table')
       if(!bookings.length){
          table.append("<td colspan='4'>No packages booked yet</td>")
       } else{
          bookings.forEach(booking=>{
            let row = `<tr>
                  <td><a href="package.html?id=${booking.package_id}">${booking.package_title}</a></td></td>
                  <td>${booking.booked_for}</td>
                  <td>${booking.quantity}</td>
                  ${(booking.status)? (booking.status=="A")? "<td><span class='status-approved'> Approved </span></td>" : "<td><span class='status-declined'> Declined </span></td>" : "<td><span class='status-pending'> Pending </span></td>"}

              </tr>` 
              table.append(row)
         })
       }
       
  })

</script>
</html>